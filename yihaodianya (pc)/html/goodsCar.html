<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>1号店(yhd.com)_全球超市，轻松到家！</title>
  <link rel="stylesheet" href="http://at.alicdn.com/t/font_1550154_688fztmvpky.css">
  <link rel="stylesheet" href="../css/nav.css">
</head>

<body>

  <!-------------------------------- 头部 ---------------------------------------->
  <div class="hd_top_bar sss w">
    <div class="wrap wc2 cl" style="padding-left: 20px;">
      <div class="hd_has_child">
        <a href="../index.html" class="hd_topbar_city">
          <i class="iconfont icon-shouye"></i>
          <span class="text">1号店首页</span>
        </a>

        <div class="hd_topbar_right">
          <ul class="cl">
            <li id="global_unlogin" style="width:100px">
              <div class="hd_unlogin">
                <span class="hd_hi" style="color: #ff4040;">Hi,请</span>
                <a href="./login.html" class="hd_login_link" style="color: #ff4040;">登录&nbsp;</a>
                <a href="./regist.html" class="hd_regist_link" style="color: #aaa;">&nbsp;注册</a>
              </div>
            </li>
            <li>
              <div class="hd_menu2" style="font-size:12px">
                <a href=""><i class="iconfont icon-wodedingdan"></i><span class="text">我的订单</span></a>
              </div>
            </li>
            <li>
              <div class="hd_menu1" style="font-size:12px">
                <a href=""><i class="iconfont icon-appxiazai" style="font-size:12px"></i><span
                    class="text">APP下载</span></a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>


  <!------------------------------ 中部 ---------------------------------->
  <div class="yhd_cart_content w">
    <div class="cart_header cl">
      <h1>
        <a href="../index.html" class="logo"><img src="../img/1.png" alt=""></a>
        <a class="logo_txt"><img src="../img/11.png" alt=""></a>
      </h1>
      <div class="search cl">
        <input type="text" placeholder="请输入关键词">
        <a id="search" class="search_btn iconfont icon-sousuo"></a>
      </div>
    </div>

    <div class="cart_list_header cart_tit cl">
      <span class="checkboxs"><input type="checkbox" class="checkAll">全选</span>
      <span class="tit">商品信息</span>
      <span class="prices">单价（元）</span>
      <span class="num">数量</span>
      <span class="total">小计（元）</span>
      <span class="act">操作</span>
    </div>

    <div class="buchongcar wc2">
      <!--<div class="cart_list">
       <div class="cart_tit_head">
        <span class="checkboxs"><input type="checkbox" class="checkone"></span>
        <span>部分食品饮料3件7折</span>
      </div>
      <ul class="cart_item11">
        <li class="cart_activity">
          <div class="cart_prod">
            <span class="tag">跨自营/店铺满折</span>
            <span class="tit">指定商品满3件总价7.0折</span>
            <span class="cut iconfont icon-vertical_line"></span>
            <a class="go_activ" href="./goodsList.html" target="_blank">查看活动&nbsp;&gt;</a>
          </div>
        </li>

        <li class="main_item">
          <div class="cart_prod cl">
            <a href="./goodsinfo.html" target="_blank" class="item_pic">
              <img class="mainCart" src="../img/a1.jpg"> </a>
            <a class="main_content">美国进口坚果 绅士牌（PLANTERS）甄选开心果混合坚果411g（含腰果、开心果、扁桃仁） </a>
            <div class="item_price">129.00</div>

            <div class="iteum cl">
              <div class="num_act">
                <a class="minus">−</a>
                <input type="text" class="input12" value="1">
                <a class="add">+</a>
              </div>
            </div>

            <div class="item_amount">
              <div class="item_a_money">516.00</div>
              <div class="item_a_weight">1.84kg</div>
            </div>

            <div class="item_act">
              <i class="iconfont icon-xinaixin"></i>
              <i class="iconfont icon-lajixiang del"></i>
            </div>
          </div>
        </li>
      </ul>

      <div class="cart_amount cl">
        <div class="amount">商品总价：<span><em>¥</em>0</span></div>
      </div> 
    </div>-->
    </div>

    <div class="pay_tools_inner w cl">
      <div class="pay_tools_inner cl">
        <div class="pay_tools_l cl">
          <input type="checkbox" class="checkAll">
          <label class="all_checked_label">全选（共<b class="hh">0</b>件）</label>
          <i class="iconfont  icon-vertical_line"></i>
          <span class="wu">清除无效商品</span>
          <i class="iconfont  icon-vertical_line ff"></i>
          <span class="delAll">批量删除</span>
        </div>

        <div class="pay_tools_r cl">
          <div class="r_prod_view r_control_tip cl">
            <span class="rpv_count">已选商品<b class="ert">0</b>件</span>
            <a class="pvw">预览</a> |
          </div>
          <div class="r_price_total cl"> 合计：
            <span class="rpt_count">¥<b class="lastPrice">00.00</b></span>
          </div>
          <a class="checkout_btn1">去结算</a>
        </div>

      </div>



    </div>
  </div>









  <footer class="card w">
    <div class="ft_wrap w">
      <div class="ft_footer_service wc2">
        <p class="cl" style="  margin-left:90px ">
          <img alt="" src="../img/15.jpg">
          <b>正品保障</b>
          <span>正品行货 放心选购</span>
        </p>
        <p class="cl">
          <img alt="" src="../img/16.jpg">
          <b>满99包邮</b>
          <span>满99元 免运费</span>
        </p>
        <p class="cl">
          <img alt="" src="../img/17.jpg">
          <b>售后无忧</b>
          <span>7天无理由退货</span>
        </p>
        <p class="cl thelast">
          <img alt="" src="../img/18.jpg">
          <b>准时送达</b>
          <span>收货时间由你做主</span>
        </p>
      </div>

      <div class="ft_service_link wc2 cl">
        <div class="ft_help_list cl" style="  margin-left:90px ">
          <dl>
            <dt>新手入门</dt>
            <dd class="sl"><a href="" target="_blank">购物流程</a></dd>
            <dd class="sl"><a href="" target="_blank">会员制度</a></dd>
            <dd class="sl"><a href="" target="_blank">订单查询</a></dd>
            <dd class="sl"><a href="" target="_blank">服务协议及隐私说明</a></dd>
            <dd class="sl"><a href="" target="_blank">网站地图</a></dd>
          </dl>
          <dl>
            <dt>支付方式</dt>
            <dd class="sl"><a href="" target="_blank">货到付款</a></dd>
            <dd class="sl"><a href="" target="_blank">网上支付</a></dd>
            <dd class="sl"><a href="" target="_blank">礼品卡支付</a></dd>
            <dd class="sl"><a href="" target="_blank">其它支付</a></dd>
          </dl>
          <dl>
            <dt>配送服务</dt>
            <dd class="sl"><a href="" target="_blank">配送进度查询</a></dd>
            <dd class="sl"><a href="" target="_blank">商品验货与签收</a></dd>
          </dl>
          <dl>
            <dt>相关规则</dt>
            <dd class="sl"><a href="" target="_blank">平台规则</a></dd>
            <dd class="sl"><a href="" target="_blank">退换货政策</a></dd>
            <dd class="sl"><a href="" target="_blank">发票制度</a></dd>
            <dd class="sl"><a href="" target="_blank">帮助中心</a></dd>
          </dl>
        </div>
        <!--footer 二维码 begin -->
        <div class="ft_code_wrap cl">
          <div class="ft_mobile_code ">
            <p>APP更优惠</p>
            <a href="" target="_blank">
              <img src="../img/5.png" alt="APP更优惠二维码">
            </a>
          </div>
          <div class="ft_mobile_code ft_mobile_code2">
            <p>加微信查订单</p>
            <img src="../img/19.jpg" alt="加微信查订单二维码">
          </div>
        </div>
      </div>

      <div id="footer" class="footers w">
        <p class="ft_footer_link w">
          <a target="_blank">沪ICP备16050468号</a>|<a href="" target="_blank">经营证照</a>|<a href=""
            target="_blank">互联网药品信息服务资格证(沪)-经营性-2017-0006</a>|<a target="_blank">违法和不良信息举报电话：0527-88100253</a>|<a
            href="" target="_blank">沪B2-20170039</a>|<a href="" target="_blank">沪公网安备 31010502002939号</a>|<a href=""
            target="_blank">友情链接</a>|<a href="" target="_blank">出版物经营许可证</a>|<a href="" target="_blank">增值电信业务经营许可证</a>
        </p>
        <p>Copyright© 1号店网上超市 2007-2019，All Rights Reserved</p>

        <p class="ft_pic_link">
          <a href="" target="_blank"><img alt="" src="../img/20.jpg"></a>
          <a href="" target="_blank"><img alt="" src="../img/6.png"></a>
          <a href="" target="_blank"><img alt="" src="../img/21.jpg"> </a>
          <a href="" target="_blank"><img alt="" src="../img/22.jpg"></a>
          <a href="" target="_blank"><img alt="" src="../img/7.png"></a>
          <a href="" target="_blank"><img alt="" src="../img/8.png"></a>
          <a href="" target="_blank"><img alt="" src="../img/23.jpg"></a>
        </p>
      </div>
    </div>

</body>
<script src="../js/jquery-1.10.1.min.js"></script>
<script src="../js/cookie.js"></script>
<script>


  var cookie = document.cookie;


  if (cookie) {
    var log_user = getCookie("log_user");
    if (log_user) {
      var html = `
      <span class="hd_hi" style="color: #ff4040;">Hi,${log_user}</span>
        <a href="" class="hd_exit_link" style="color: #aaa;">&nbsp;退出登录</a>
      `
      $(".sss  ").html(html)
    }else{
    location.href = "./login.html";
  }
  }

  $(".sss .hd_exit_link").click(function () {
    setCookie("log_user", "", -7);
    setCookie("log_pwd", "", -7);
    setCookie("log_id", "", -7);
  })

  var user = getCookie("log_user");
  $.ajax({
    type: "get",
    dataType: "json",
    data: {
      user,
    },
    url: "../php/goodsshop.php",
    success(res) {
      var html = '';
      count = 0;
      res.forEach(({ id, username, goodsId, goodsName, goodsMsg, goodsPrice, goodsWeight, goodsImg, goodsNum, goodsImgList }) => {
        html += `
       <div class="cart_list wc2" proId="${id}"  num="${count++}">
       <div class="cart_tit_head">
        <span class="checkboxs"><input  type="checkbox" class="checkone"></span>
        <span>部分商品3件7折</span>
      </div>
      <ul class="cart_item11">
        <li class="cart_activity">
          <div class="cart_prod">
            <span class="tag">跨自营/店铺满折</span>
            <span class="tit">指定商品满3件总价7.0折</span>
            <span class="cut iconfont icon-vertical_line"></span>
            <a class="go_activ" href="./goodsList.html" target="_blank">查看活动&nbsp;&gt;</a>
          </div>
        </li>

        <li class="main_item " goodsId=${goodsId}>
          <div class="cart_prod cl">
            <a href="./goodsinfo.html" target="_blank" class="item_pic">
              <img class="mainCart" src="../img/${goodsImg}"> </a>
            <a class="main_content">${goodsMsg}</a>
            <div class="item_price">${goodsPrice}</div>

            <div class="iteum cl">
              <div class="num_act">
                <a class="minuss" >−</a>
                <input type="text" class="input12" value="${goodsNum}">
                <a class="addd">+</a>
              </div>
            </div>

            <div class="item_amount">
              <div class="item_a_money">${(goodsPrice * goodsNum).toFixed(2)}</div>
              <div class="item_a_weight">${goodsWeight}kg</div>
            </div>

            <div class="item_act">
              <i class="iconfont icon-xinaixin"></i>
              <i class="iconfont icon-lajixiang del"></i>
            </div>
          </div>
        </li>
      </ul>

      <div class="cart_amount cl">
        <div class="amount">商品总价：<span><em>¥</em>${(goodsPrice * goodsNum).toFixed(2)}</span></div>
      </div>
      </div>
       `
      });
      total();
      $(".buchongcar").html(html);


      // 全选
      $(".checkAll").click(function () {
        var flag = $(this).prop("checked");
        $(".checkone").prop("checked", flag);
        $(".checkAll").prop("checked", flag);
      })

      // 单选
      $(".checkone").click(function () {
        if ($(".checkone:checked").length == $(".checkone").length) {
          $(".checkAll").prop("checked", true);
        } else {
          $(".checkAll").prop("checked", false);
        }
      })

      if ($(".checkone,.checkAll").click(function () {
        total();


      }))

        // 添加商品
        $(".addd").click(function () {
          var user = getCookie("log_user")
          var index = $(this).index(".cart_list .addd");
          var goodsId = $(".main_item").eq(index).attr("goodsId");
          $(".input12").eq(index).val(($(".input12").eq(index).val() * 1 + 1))
          var goodsNum = $(".input12").eq(index).val();
          $(".item_a_money").eq(index).html(($(".input12").eq(index).val()*$(".item_price").html()).toFixed(2));
          $.ajax({
            type: "get",
            dataType: "json",
            data: {
              user,
              goodsId,
              goodsNum
            },
            url: "../php/goodsCaradd.php",
            success(res) {
              // console.log(res)
              if (res.status) {
               
                alert("商品添加成功");
                total()

              } else {
                alert("数据库正在更新中,请稍后再试!!");
              }
            }
          })
        })

      // 减少商品
      $(".minuss").click(function () {
        var index = $(this).index(".cart_list .minuss");
        var goodsId = $(".main_item").eq(index).attr("goodsId");
        if ($(".input12").eq(index).val() <= 1) {
          $(".input12").eq(index).val(1)
          $(this).css("disabled", true);
          return
        }
        $(".input12").eq(index).val(($(".input12").eq(index).val() * 1 - 1))
        var goodsNum = $(".input12").eq(index).val();
        $(".item_a_money").eq(index).html(($(".input12").eq(index).val()*$(".item_price").html()).toFixed(2));
        $.ajax({
          type: "get",
          dataType: "json",
          data: {
            user,
            goodsId,
            goodsNum
          },
          url: "../php/goodsCaradd.php",
          success(res) {
            console.log(res)
            if (res.status) {
              
              alert("商品更新成功");
              total()
            } else {
              alert("数据库正在更新中,请稍后再试!!");
            }
          }
        })
      })

      // 单个删除     

      $(".del").click(function () {
        var index = $(this).index(".cart_list .del");
        var goodsId = $(".main_item").eq(index).attr("goodsId");
        $(".cart_list").eq(index).remove();
        $.ajax({
          user,
          type: "get",
          dataType: "json",
          data: {
            user,
            goodsId,
          },
          url: "../php/goodsdel.php",
          success(res) {
            console.log(res)
            if (res.status) {
              alert("商品删除成功");
              total()
            } else {
              alert("数据库正在更新中,请稍后再试!!");
            }
          }
        })
      })

    }
  })



  $(".delAll").click(function () {

    var list = $("input[type='checkbox']:checked").map(function () {
      return $(this).parents(".cart_list").attr("proId");
    }).get();

    var id = list.join(",");
    // console.log(id);
    $.ajax({
      type: "get",
      dataType: "json",
      data: {
        user,
        id,
      },
      url: "../php/goodsdelAll.php",
      success(res) {
        // console.log(res)
        if (res.status) {
          alert("商品删除成功");
          location.reload();
          total()
        } else {
          alert("数据库正在更新中,请稍后再试!!");
        }
      }
    })

  })




  total();

  function total() {
    var sum = 0;
    var allPrice = 0;
    var list = $("input[type='checkbox']:checked").map(function () {
      return $(this).parents(".cart_list").attr("num");
    }).get();

    list.forEach(function (index) {
      sum += ($(".input12").eq(index).val() * 1);
      allPrice += ($(".item_a_money").eq(index).html() * 1);
    })
    $(".lastPrice").html((allPrice).toFixed(2));
    $(".ert").html(sum);
    $(".hh").html($(".cart_list").length)


    setCookie("aa",  $(".lastPrice").html());
    setCookie("aaa", $(".ert").html());
  }

  $(".checkout_btn1").click(function () {
    location.href = "./thlaster.html"
  })



</script>

</html>