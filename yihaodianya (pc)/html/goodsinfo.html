<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>1号店(yhd.com)_全球超市，轻松到家！</title>
  <link rel="stylesheet" href="http://at.alicdn.com/t/font_1550154_p9yy1y14rbo.css">
  <link rel="stylesheet" href="../css/nav.css">
</head>

<body>
  <header class="uuuu"></header>

  <div class="detail_wrap w">
    <!-- 头部 -->
    <div class="mod_detail_crumb wc1">
      <div class="crumb sl">
        <a target="_blank" href="./goodsList.html"><em>食品饮料</em><i class="iconfont icon-next-copy"></i></a>
        <a target="_blank" href="./goodsList.html"><em>进口食品</em><i class="iconfont icon-next-copy"></i></a>
        <a target="_blank" href="./goodsList.html"><em>休闲零食</em><i class="iconfont icon-next-copy"></i></a>
        <a target="_blank" href="./goodsList.html"><em>亨利摩根（Henry Morgan</em><i class="iconfont icon-next-copy"></i></a>
        <span> <em>亨利摩根香蕉干</em></span>
      </div>
    </div>

    <!-- 详情 -->
    <div class="fm_detail_one wc1 cl">
      <!-- 左侧 -->
      <!-- <div class="a1">
        <div class="mod_detail_preview">
          <div class="proImg_border">
            <div class="dede">
              <img src="../img/a1.jpg" alt="" class="proImg">
              <div class="shadow"></div>
            </div>
          </div>
          <div class="proCrumb">
            <i class="btn prev1 iconfont icon-xiangzuo2"></i>
            <i class="btn next1 iconfont icon-next-copy"></i>
            <div class="hideBox">
              <ul class="mBox cl">
                <li class="a2"><img src="../img/a1.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a2.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a3.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a4.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a5.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a6.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a3.jpg" alt="" class="aa"></li>
                <li class="a2"><img src="../img/a4.jpg" alt="" class="aa"></li>
              </ul>
            </div>
          </div>
          <div class="product_rel">
            <span class="prod_l"><span class="product_id">商品编号</span>5936450</span>
            <span class="collect_icon">
              <i class="iconfont icon-vertical_line"></i>
              <i class="iconfont icon-xinaixin"></i>
            </span>
            <span class="collect_text">关注</span>
          </div>
        </div>
      </div>

     
      <div class="main_content">

        <div class="J_zoom">
          <img src="../img/a1.jpg">
        </div>

        <div class="mod_detailInfo_proName sl"><span class="self_icon">自营</span>泰国进口 亨利摩根（Henry Morgan）香蕉干 120g 进口水果干果蔬干
        </div>

        <div class="price cl">
          <ul class="cl">
            <li class="tag">价格</li>
            <li class="number">¥18.8</li>
          </ul>
        </div>

        <ul class="Msgsale">
          <li class="skuGoodCommentRate">
            <span class="iconfont icon-diancai1-copy"></span>好评率<strong class="rate">99%</strong></span>
            <span class="paise_num">[评论<span class="yellow">2.2万+</span>条]</span></li>
        </ul>

        <div class="mod_detailInfo_tags noborder">
          <div class="suit cl">
            <span class="_item">优惠券</span>
            <span class="_right"><span class="_right1">满169减30</span></span>
            <span class="_left">领取优惠券 <i class="iconfont icon-iconzhongxinzhengli-"></i></span>
          </div>
        </div>

        <div class="mod_detailInfo_tags mod_detailInfo_promotion cl">
          <span class="_item">促销</span>
          <span class="sub">跨自营/店铺满减</span>
          <span class="Layer_main sl">每满199元，可减100元现金</span>
          <span class="link">立即参加</span>
          <span class="links">共<span class="yow">1</span>项,展开查看 <i
              class="iconfont icon-iconzhongxinzhengli-"></i></span>
        </div>

        <div class="mod_detailInfo_tags warranty_box cl">
          <span class="_item">选择颜色：</span>
          <div class="choose-attr-1 cl">
            <img src="../img/a1.jpg" alt="" class="_product_pic_class">
            <i class="sl">香蕉干120g</i>
            <span class="youyong">
              <em class="iconfont icon-duihao1"></em>
            </span>
          </div>
        </div>

        <div class="mod_detailInfo_tags getgoods cl">
          <div class="shopping_num cl">
            <input value="1" type="text" class="input2">
            <p>
              <span class="zengjian add1"><i class="iconfont icon-iconzhongxinzhengli-1"></i></span>
              <span class="zengjian reduce1"><i class="iconfont icon-iconzhongxinzhengli-"></i></span>
            </p>
          </div>
          <div class="shopping_act "> <em class="iconfont icon-gouwuche"></em>加入购物车</div>
          <span class="infor">降价通知</span>
        </div>
      </div>



     
      <div class="mod_change">
        <div class="pageclick">
          <span class="keycount">看了又看</span>
          <span class="keycount1"><i class="iconfont icon-refresh"></i>换一批</span>
        </div>
        <ul class="product_">
          <li>
            <a href="./goodsList.html"> <img src="../img/a1.jpg" alt=""></a>
            <p class="sl">亨利摩根（Henry Morgan） 无花果干 进口 果干 儿童零食 35g 休闲小零食</p>
            <p class="zuihou">¥1888.8</p>
          </li>
          <li>
            <a href="./goodsList.html"> <img src="../img/a2.jpg" alt=""></a>
            <p class="sl">亨利摩根（Henry Morgan） 无花果干 进口 果干 儿童零食 35g 休闲小零食</p>
            <p class="zuihou">¥1788.8</p>
          </li>
          <li>
            <a href="./goodsList.html"> <img src="../img/a2.jpg" alt=""></a>
            <p class="sl">亨利摩根（Henry Morgan） 无花果干 进口 果干 儿童零食 35g 休闲小零食</p>
            <p class="zuihou">¥1848.8</p>
          </li>
        </ul>
      </div>
    </div> -->
    </div>

    <footer></footer>
</body>

<script src="../js/jquery-1.10.1.min.js"></script>
<script src="../js/cookie.js"></script>
<script>
  $("header").load("header.html", function () {
    $.getScript("../js/nav.js", function () {
      $("footer").load("footer.html");

      var cookie = document.cookie;
      if (cookie) {
        var log_user = getCookie("log_user");
        if (log_user) {
          var html = `
      <span class="hd_hi">欢迎,${log_user}的</span>
                  <a href="" class="hd_login_link " style="color: #ff4040;">登录&nbsp;</a>
                  <a href="" class="hd_exit_link" style="color: #aaa;">&nbsp;退出登录</a>
      `
          $(".uuuu .hd_unlogin").html(html)
        }
      }

      $(".uuuu .hd_exit_link").click(function () {
        setCookie("log_user", "", -7);
        setCookie("log_pwd", "", -7);
        setCookie("log_id", "", -7);
      })


    });


  });

  var search = location.search;
  if (!search) {
    location.href = "./goodsList.html";
  } else {
    goodsId = search.split("=")[1];
    $.ajax({
      type: "get",
      dataType: "json",
      data: {
        goodsId
      },
      url: "../php/goodsinfo.php",
      success(res) {
        var { id, goodsId, goodsName, goodsMsg, goodsPrice, goodsWeight, goodsImg, goodsNum, goodsImgList } = res[0];
        var imgs = '';
        goodsImgList.forEach(element => {
          imgs += `
          <li class="a2"><img src="../img/${element}" alt="" class="aa"></li>
          `
        });
        var html = `
        <div class="a1">
        <div class="mod_detail_preview">
          <div class="proImg_border">
            <div class="dede">
              <img src="../img/${goodsImg}" alt="" class="proImg">
              <div class="shadow"></div>
            </div>
          </div>
          <div class="proCrumb">
            <i class="btn prev1 iconfont icon-xiangzuo2"></i>
            <i class="btn next1 iconfont icon-next-copy"></i>
            <div class="hideBox">
              <ul class="mBox cl">
               ${imgs}
              </ul>
            </div>
          </div>
          <div class="product_rel">
            <span class="prod_l"><span class="product_id">商品编号</span>${(Math.random().toString().replace(".", ""))}</span>
            <span class="collect_icon">
              <i class="iconfont icon-vertical_line"></i>
              <i class="iconfont icon-xinaixin"></i>
            </span>
            <span class="collect_text">关注</span>
          </div>
        </div>
      </div>

      <!-- 中部 -->
      <div class="main_content">

        <div class="J_zoom">
          <img src="../img/${goodsImg}">
        </div>

        <div class="mod_detailInfo_proName sl"><span class="self_icon">自营</span>${goodsMsg}
        </div>

        <div class="price cl">
          <ul class="cl">
            <li class="tag">价格</li>
            <li class="number">¥${goodsPrice}</li>
          </ul>
        </div>

        <ul class="Msgsale">
          <li class="skuGoodCommentRate">
            <span class="iconfont icon-diancai1-copy"></span>好评率<strong class="rate">${80 + Math.round(Math.random() * (99 - 80))}%</strong></span>
            <span class="paise_num">[评论<span class="yellow">${1 + Math.round(Math.random() * (27 - 1))}万+</span>条]</span></li>
        </ul>

        <div class="mod_detailInfo_tags noborder">
          <div class="suit cl">
            <span class="_item">优惠券</span>
            <span class="_right"><span class="_right1">满${200 + Math.round(Math.random() * (400 - 200))}减30</span></span>
            <span class="_left">领取优惠券 <i class="iconfont icon-iconzhongxinzhengli-"></i></span>
          </div>
        </div>

        <div class="mod_detailInfo_tags mod_detailInfo_promotion cl">
          <span class="_item">促销</span>
          <span class="sub">跨自营/店铺满减</span>
          <span class="Layer_main sl">每满499元，可减100元现金</span>
          <span class="link">立即参加</span>
          <span class="links">共<span class="yow">1</span>项,展开查看 <i
              class="iconfont icon-iconzhongxinzhengli-"></i></span>
        </div>

        <div class="mod_detailInfo_tags warranty_box cl">
          <span class="_item">选择颜色：</span>
          <div class="choose-attr-1 cl">
            <img src="../img/${goodsImg}" alt="" class="_product_pic_class">
            <i class="sl">${goodsName}</i>
            <span class="youyong">
              <em class="iconfont icon-duihao1"></em>
            </span>
          </div>
        </div>

        <div class="mod_detailInfo_tags getgoods cl">
          <div class="shopping_num cl">
            <input value="1" type="text" class="input2">
            <p>
              <span class="zengjian add1"><i class="iconfont icon-iconzhongxinzhengli-1"></i></span>
              <span class="zengjian reduce1"><i class="iconfont icon-iconzhongxinzhengli-"></i></span>
            </p>
          </div>
          <div class="shopping_act "> <em class="iconfont icon-gouwuche"></em>加入购物车</div>
          <span class="infor">降价通知</span>
        </div>
      </div>



      <!-- 右侧 -->
      <div class="mod_change">
        <div class="pageclick">
          <span class="keycount">看了又看</span>
          <span class="keycount1"><i class="iconfont icon-refresh"></i>换一批</span>
        </div>
        <ul class="product_">
          <li>
            <a href="./goodsList.html"> <img src="../img/${goodsImgList[0]}" alt=""></a>
            <p class="sl">${goodsMsg}</p>
            <p class="zuihou">¥${(1000 + Math.round(Math.random() * (goodsPrice - 1000))).toFixed(2)}</p>
          </li>
          <li>
            <a href="./goodsList.html"> <img src="../img/${goodsImgList[1]}" alt=""></a>
            <p class="sl">${goodsMsg}</p>
            <p class="zuihou">¥${(1000 + Math.round(Math.random() * (goodsPrice - 1000))).toFixed(2)}</p>
          </li>
          <li>
            <a href="./goodsList.html"> <img src="../img/${goodsImgList[2]}" alt=""></a>
            <p class="sl">${goodsMsg}</p>
            <p class="zuihou">¥${(1000 + Math.round(Math.random() * (goodsPrice - 1000))).toFixed(2)}</p>
          </li>
        </ul>
      </div>
    </div>
        
        `

        $(".fm_detail_one").html(html);


        $(".prev1").css("disabled", false);
        $(".next1").css("disabled", false);
        var index3 = 0
        if (index3 <= 0) {
          $(".prev1").css("disabled", true);
        }
        // console.log(index3,$(".a2").length-1,Math.floor(($(".a2").length)/5));
        if (index3 >= Math.floor($(".a2").length-1)%5) {
          $(".next1").css("disabled", false);
        }

        $(".prev1").click(function () {
          if (index3 <= 0) {
            index3 = 0;
            $(".prev1").css("disabled", true);
            return
          }
          index3--;
          $(".mBox").animate({ left: -$(".hideBox").width() * index3 })
        })

        $(".next1").click(function () {

          if (index3 >= Math.floor(($(".a2").length)/5)) {
            index3 = Math.floor(($(".a2").length)/5);
            $(".next1").css("disabled", false);
            return
          }
          index3++;
          $(".mBox").animate({ left: -$(".hideBox").width() * index3 })
        })


        //购物车加减
        $(".add1").css("disabled", false);
        $(".reduce1").css("disabled", false);

        $(".add1").click(function () {
          count = $(".input2").val();
          $(".input2").val(count * 1 + 1)
        })

        $(".reduce1").click(function () {
          count = $(".input2").val();
          if (count <= 1) {
            $(".reduce1").css("disabled", true);
            return;
          }
          $(".input2").val(count * 1 - 1)
        })


        //放大镜效果示例
        $(".a2").mouseenter(function () {
          var index = $(this).index();         //获取触摸图片的下标
          $(".proImg").attr("src", $(".aa").eq(index).attr("src"));     //小图显示触摸的图片
          $(".J_zoom img").attr("src", $(".aa").eq(index).attr("src")); //大图显示触摸的图片
        }) 

        $(".dede").height("360")
        var maxLeft = $(".dede").width() - $(".shadow").outerWidth();   //遮罩向左最大的可移动距离
        var maxTop = $(".dede").height() - $(".shadow").outerHeight();  //遮罩向下最大可移动距离

        // console.log($(".dede").width(), $(".shadow").outerWidth(), maxLeft);
        // console.log($(".dede").height(), $(".shadow").outerHeight(), maxTop);
        // clientX、clientY 鼠标相对于浏览器窗口可视区域的X，Y坐标/ pageX、pageY 鼠标相对于文档(有滚动条)的X，Y坐标 /  offsetX、offsetY   鼠标相对于事件源(父元素)的X,Y坐标
        // 元素样式宽,高   width / height
        // 元素内容宽,高   ele.clientWidth / ele.clientHeight  padding+width / padding+height
        // 实际宽,高       ele.offsetWidth / ele.offsetHeight  padding+border+width /padding+border+height
        // 相对父元素的距离 ele.offsetTop   / ele.offsetLeft

        $(".dede").mouseleave(function (e) {
          $(".shadow").css("display", "none");  //遮罩隐藏
          $(".J_zoom").css("display", "none");  //装大盒子大盒子隐藏
        })

        $(".dede").mousemove(function (e) {
          $(".shadow").css("display", "block");  
          $(".J_zoom").css("display", "block");
          $(".J_zoom img").attr("src", $(".dede img").attr("src"));
          var ev = e || event;
          var x = ev.pageX;
          var y = ev.pageY;
          let lefts = x - $(".dede").offset().left - $(".shadow").width() / 2;
          let tops = y - $(".dede").offset().top - $(".shadow").height() / 2;

          if (lefts <= 0) {
            lefts = 0;
          }
          if (lefts >= maxLeft) {
            lefts = maxLeft
          }
          if (tops <= 0) {
            tops = 0;
          }
          if (tops >= maxTop) {
            tops = maxTop
          }

          $(".shadow").css("left", `${lefts}px`);
          $(".shadow").css("top", `${tops}px`);

          var sale1 = $(".J_zoom img").outerWidth() / $(".dede").outerWidth();
          var sale2 = $(".J_zoom img").outerHeight() / $(".dede").outerHeight();
          $(".J_zoom img").css("left", `-${sale1 * lefts}px`);
          $(".J_zoom img").css("top", `-${sale2 * tops}px`);
        })


        $(".shopping_act").click(function () {
          var buy_num = $(".input2").val();
          var user = getCookie("log_user");
          if (user) {
            $.ajax({
              type: "get",
              dataType: "json",
              data: {
                user,
                goodsId,
                buy_num
              },
              url: "../php/usergoods.php",
              success(res) {
                if (res.status) {
                  if (confirm("添加成功,是否进入购物车?")) {
                    location.href = "./goodsCar.html";
                  }
                } else {
                  alert(res.msg);
                }
              }
            })
          } else {
            if (confirm("您还没有登录,是否登录?")) {
              var backUrl = location.href;
              setCookie("backUrl", backUrl);
              location.href = "./login.html";
            }
          }
        })
      }
    })
  }
  



</script>

</html>